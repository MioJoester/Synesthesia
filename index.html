<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Synesthesia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

  <style>
    canvas {
      position: fixed;
      inset: 0;
      z-index: 0;
    }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      height: 12px;
      width: 12px;
      border-radius: 50%;
      background: white;
      cursor: pointer;
    }
  </style>
</head>

<body class="bg-black text-white overflow-hidden">

<!-- Drag & Drop -->
<div id="dropZone"
     class="fixed inset-0 z-40 flex items-center justify-center
            border-2 border-dashed border-white/20
            text-white/50 text-lg transition">
  Drop MP3 to begin
</div>

<!-- TITLE -->
<div class="fixed top-6 left-1/2 -translate-x-1/2 z-30
            flex items-center gap-3
            px-6 py-3 rounded-full
            bg-white/5 backdrop-blur
            border border-white/10
            text-sm tracking-wide text-white/70">
  <span>Synesthesia</span>
  <a href="https://github.com/your-username/synesthesia"
     target="_blank"
     class="opacity-70 hover:opacity-100 transition">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 .5C5.73.5.5 5.74.5 12.02c0 5.1 3.29 9.42 7.86 10.95.58.1.79-.25.79-.56v-2.02c-3.2.7-3.87-1.54-3.87-1.54-.52-1.34-1.27-1.7-1.27-1.7-1.04-.71.08-.7.08-.7 1.15.08 1.76 1.18 1.76 1.18 1.02 1.75 2.67 1.25 3.32.96.1-.74.4-1.25.72-1.54-2.55-.29-5.23-1.28-5.23-5.7 0-1.26.45-2.29 1.18-3.1-.12-.29-.51-1.46.11-3.05 0 0 .96-.31 3.14 1.18a10.9 10.9 0 0 1 2.86-.38c.97 0 1.95.13 2.86.38 2.18-1.49 3.14-1.18 3.14-1.18.62 1.59.23 2.76.11 3.05.73.81 1.18 1.84 1.18 3.1 0 4.43-2.69 5.4-5.25 5.69.41.36.77 1.06.77 2.14v3.17c0 .31.21.67.8.56 4.56-1.53 7.85-5.85 7.85-10.95C23.5 5.74 18.27.5 12 .5z"/>
    </svg>
  </a>
</div>

<!-- LEFT SIDEBAR -->
<div class="fixed left-4 top-1/2 -translate-y-1/2 z-30
            w-56 p-4 rounded-xl
            bg-white/5 backdrop-blur
            border border-white/10
            text-sm space-y-3 text-white/70">
  <div class="text-white/90">Track Info</div>
  <div>Artist: —</div>
  <div>BPM: —</div>
  <div>Energy: —</div>
</div>

<!-- RIGHT SIDEBAR -->
<div class="fixed right-4 top-1/2 -translate-y-1/2 z-30
            w-44 space-y-4">

  <div class="p-3 rounded-xl bg-white/5 backdrop-blur border border-white/10
              text-xs space-y-3 text-white/60">
    <div class="text-white/80">Particle Color</div>
    <div class="grid grid-cols-4 gap-2">
      <button class="w-5 h-5 rounded-full bg-white" data-color="#ffffff"></button>
      <button class="w-5 h-5 rounded-full bg-cyan-400" data-color="#22d3ee"></button>
      <button class="w-5 h-5 rounded-full bg-purple-400" data-color="#c084fc"></button>
      <button class="w-5 h-5 rounded-full bg-pink-400" data-color="#f472b6"></button>
      <button class="w-5 h-5 rounded-full bg-green-400" data-color="#4ade80"></button>
      <button class="w-5 h-5 rounded-full bg-yellow-400" data-color="#facc15"></button>
      <button class="w-5 h-5 rounded-full bg-red-400" data-color="#f87171"></button>
      <button class="w-5 h-5 rounded-full bg-blue-400" data-color="#60a5fa"></button>
    </div>
  </div>
</div>

<!-- CONTROLS -->
<div class="fixed bottom-6 left-1/2 -translate-x-1/2 z-30
            w-[420px] space-y-3">

  <button id="playBtn"
          class="w-full py-3 rounded-full
                 bg-white/10 hover:bg-white/20
                 border border-white/10
                 flex items-center justify-center
                 transition">

    <svg id="playIcon" width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
      <polygon points="5,3 19,12 5,21"></polygon>
    </svg>

    <svg id="pauseIcon" class="hidden" width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
      <rect x="6" y="4" width="4" height="16"></rect>
      <rect x="14" y="4" width="4" height="16"></rect>
    </svg>

  </button>

  <input id="progress" type="range" min="0" max="100" value="0"
         class="w-full h-1 bg-white/20 rounded-lg appearance-none cursor-pointer">
</div>

<script>

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(65, innerWidth / innerHeight, 0.1, 1000);
camera.position.z = 55;

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);


const COUNT = 4000;
const geometry = new THREE.BufferGeometry();
const base = new Float32Array(COUNT * 3);
const pos = new Float32Array(COUNT * 3);

for (let i = 0; i < COUNT; i++) {
  const r = 18 + Math.random() * 8;
  const t = Math.random() * Math.PI * 2;
  const p = Math.acos(2 * Math.random() - 1);
  const x = r * Math.sin(p) * Math.cos(t);
  const y = r * Math.sin(p) * Math.sin(t);
  const z = r * Math.cos(p);
  base.set([x,y,z], i*3);
  pos.set([x,y,z], i*3);
}

geometry.setAttribute("position", new THREE.BufferAttribute(pos,3));

const material = new THREE.PointsMaterial({
  color: 0xffffff,
  size: 0.18,
  transparent: true,
  opacity: 0.75
});

const particles = new THREE.Points(geometry, material);
scene.add(particles);


let audio, ctx, analyser, source, data;

function setupAudio(file) {
  if (ctx) ctx.close();

  ctx = new (AudioContext || webkitAudioContext)();
  analyser = ctx.createAnalyser();
  analyser.fftSize = 2048;
  data = new Uint8Array(analyser.frequencyBinCount);

  audio = new Audio(URL.createObjectURL(file));
  audio.crossOrigin = "anonymous";

  source = ctx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(ctx.destination);
}


const dropZone = document.getElementById("dropZone");

window.addEventListener("dragover", e => {
  e.preventDefault();
  dropZone.classList.add("border-white/60", "text-white");
});

window.addEventListener("dragleave", () => {
  dropZone.classList.remove("border-white/60", "text-white");
});

window.addEventListener("drop", e => {
  e.preventDefault();
  dropZone.classList.add("hidden");

  const file = e.dataTransfer.files[0];
  if (file && file.type.includes("audio")) {
    setupAudio(file);
  }
});


const playIcon = document.getElementById("playIcon");
const pauseIcon = document.getElementById("pauseIcon");
const progress = document.getElementById("progress");

function toggleIcons(p){
  playIcon.classList.toggle("hidden", p);
  pauseIcon.classList.toggle("hidden", !p);
}

document.getElementById("playBtn").onclick = () => {
  if (!audio) return;
  ctx.resume();
  if (audio.paused) {
    audio.play();
    toggleIcons(true);
  } else {
    audio.pause();
    toggleIcons(false);
  }
};

progress.addEventListener("input", () => {
  if (!audio) return;
  audio.currentTime = (progress.value / 100) * audio.duration;
});


document.querySelectorAll("[data-color]").forEach(b=>{
  b.onclick = ()=> material.color.set(b.dataset.color);
});

/* =========================
   ANIMATE
========================= */
function animate(){
  requestAnimationFrame(animate);

  if (analyser) {
    analyser.getByteFrequencyData(data);

    let bass = 0;
    for(let i=0;i<data.length*0.15;i++) bass+=data[i];
    bass/=data.length*0.15;

    for(let i=0;i<COUNT;i++){
      const f = data[i%data.length]/255;
      const w = Math.sin(performance.now()*0.002+i)*f*2;
      pos[i*3]   = base[i*3]*(1+bass*0.002)+w;
      pos[i*3+1] = base[i*3+1]*(1+bass*0.002)+w;
      pos[i*3+2] = base[i*3+2]*(1+bass*0.002)+w;
    }

    geometry.attributes.position.needsUpdate = true;
    particles.rotation.y += 0.0006;

    if (audio && audio.duration) {
      progress.value = (audio.currentTime / audio.duration) * 100;
    }
  }

  renderer.render(scene,camera);
}
animate();


addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
